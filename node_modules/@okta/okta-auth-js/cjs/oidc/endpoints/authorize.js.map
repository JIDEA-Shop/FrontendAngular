{"version":3,"file":"authorize.js","names":["convertTokenParamsToOAuthParams","tokenParams","clientId","AuthSdkError","isString","responseType","oauthParams","codeChallenge","codeChallengeMethod","display","idp","idpScope","loginHint","maxAge","nonce","prompt","redirectUri","responseMode","sessionToken","state","removeNils","forEach","mayBeArray","Array","isArray","join","scopes","scope","buildAuthorizeParams","oauthQueryParams","toQueryString","extraParams"],"sources":["../../../../lib/oidc/endpoints/authorize.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\nimport { isString, removeNils, toQueryString } from '../../util';\nimport { AuthSdkError } from '../../errors';\nimport { OAuthParams, TokenParams } from '../../types';\n\nexport function convertTokenParamsToOAuthParams(tokenParams: TokenParams) {\n  // Quick validation\n  if (!tokenParams.clientId) {\n    throw new AuthSdkError('A clientId must be specified in the OktaAuth constructor to get a token');\n  }\n\n  if (isString(tokenParams.responseType) && tokenParams.responseType.indexOf(' ') !== -1) {\n    throw new AuthSdkError('Multiple OAuth responseTypes must be defined as an array');\n  }\n\n  // Convert our params to their actual OAuth equivalents\n  var oauthParams: OAuthParams = {\n    'client_id': tokenParams.clientId,\n    'code_challenge': tokenParams.codeChallenge,\n    'code_challenge_method': tokenParams.codeChallengeMethod,\n    'display': tokenParams.display,\n    'idp': tokenParams.idp,\n    'idp_scope': tokenParams.idpScope,\n    'login_hint': tokenParams.loginHint,\n    'max_age': tokenParams.maxAge,\n    'nonce': tokenParams.nonce,\n    'prompt': tokenParams.prompt,\n    'redirect_uri': tokenParams.redirectUri,\n    'response_mode': tokenParams.responseMode,\n    'response_type': tokenParams.responseType,\n    'sessionToken': tokenParams.sessionToken,\n    'state': tokenParams.state,\n  };\n  oauthParams = removeNils(oauthParams) as OAuthParams;\n\n  ['idp_scope', 'response_type'].forEach(function (mayBeArray) {\n    if (Array.isArray(oauthParams[mayBeArray])) {\n      oauthParams[mayBeArray] = oauthParams[mayBeArray].join(' ');\n    }\n  });\n\n  if (tokenParams.responseType!.indexOf('id_token') !== -1 &&\n    tokenParams.scopes!.indexOf('openid') === -1) {\n    throw new AuthSdkError('openid scope must be specified in the scopes argument when requesting an id_token');\n  } else {\n    oauthParams.scope = tokenParams.scopes!.join(' ');\n  }\n\n  return oauthParams;\n}\n\nexport function buildAuthorizeParams(tokenParams: TokenParams) {\n  var oauthQueryParams = convertTokenParamsToOAuthParams(tokenParams);\n  return toQueryString({ \n    ...oauthQueryParams, \n    ...(tokenParams.extraParams && { ...tokenParams.extraParams })\n  });\n}\n"],"mappings":";;;;;;;;;AAcA;;AACA;;AAfA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOO,SAASA,+BAAT,CAAyCC,WAAzC,EAAmE;EAAA;;EACxE;EACA,IAAI,CAACA,WAAW,CAACC,QAAjB,EAA2B;IACzB,MAAM,IAAIC,oBAAJ,CAAiB,yEAAjB,CAAN;EACD;;EAED,IAAI,IAAAC,cAAA,EAASH,WAAW,CAACI,YAArB,KAAsC,iCAAAJ,WAAW,CAACI,YAAZ,iBAAiC,GAAjC,MAA0C,CAAC,CAArF,EAAwF;IACtF,MAAM,IAAIF,oBAAJ,CAAiB,0DAAjB,CAAN;EACD,CARuE,CAUxE;;;EACA,IAAIG,WAAwB,GAAG;IAC7B,aAAaL,WAAW,CAACC,QADI;IAE7B,kBAAkBD,WAAW,CAACM,aAFD;IAG7B,yBAAyBN,WAAW,CAACO,mBAHR;IAI7B,WAAWP,WAAW,CAACQ,OAJM;IAK7B,OAAOR,WAAW,CAACS,GALU;IAM7B,aAAaT,WAAW,CAACU,QANI;IAO7B,cAAcV,WAAW,CAACW,SAPG;IAQ7B,WAAWX,WAAW,CAACY,MARM;IAS7B,SAASZ,WAAW,CAACa,KATQ;IAU7B,UAAUb,WAAW,CAACc,MAVO;IAW7B,gBAAgBd,WAAW,CAACe,WAXC;IAY7B,iBAAiBf,WAAW,CAACgB,YAZA;IAa7B,iBAAiBhB,WAAW,CAACI,YAbA;IAc7B,gBAAgBJ,WAAW,CAACiB,YAdC;IAe7B,SAASjB,WAAW,CAACkB;EAfQ,CAA/B;EAiBAb,WAAW,GAAG,IAAAc,gBAAA,EAAWd,WAAX,CAAd;EAEA,CAAC,WAAD,EAAc,eAAd,EAA+Be,OAA/B,CAAuC,UAAUC,UAAV,EAAsB;IAC3D,IAAIC,KAAK,CAACC,OAAN,CAAclB,WAAW,CAACgB,UAAD,CAAzB,CAAJ,EAA4C;MAC1ChB,WAAW,CAACgB,UAAD,CAAX,GAA0BhB,WAAW,CAACgB,UAAD,CAAX,CAAwBG,IAAxB,CAA6B,GAA7B,CAA1B;IACD;EACF,CAJD;;EAMA,IAAI,kCAAAxB,WAAW,CAACI,YAAZ,kBAAkC,UAAlC,MAAkD,CAAC,CAAnD,IACF,kCAAAJ,WAAW,CAACyB,MAAZ,kBAA4B,QAA5B,MAA0C,CAAC,CAD7C,EACgD;IAC9C,MAAM,IAAIvB,oBAAJ,CAAiB,mFAAjB,CAAN;EACD,CAHD,MAGO;IACLG,WAAW,CAACqB,KAAZ,GAAoB1B,WAAW,CAACyB,MAAZ,CAAoBD,IAApB,CAAyB,GAAzB,CAApB;EACD;;EAED,OAAOnB,WAAP;AACD;;AAEM,SAASsB,oBAAT,CAA8B3B,WAA9B,EAAwD;EAC7D,IAAI4B,gBAAgB,GAAG7B,+BAA+B,CAACC,WAAD,CAAtD;EACA,OAAO,IAAA6B,mBAAA,EAAc,EACnB,GAAGD,gBADgB;IAEnB,IAAI5B,WAAW,CAAC8B,WAAZ,IAA2B,EAAE,GAAG9B,WAAW,CAAC8B;IAAjB,CAA/B;EAFmB,CAAd,CAAP;AAID"}